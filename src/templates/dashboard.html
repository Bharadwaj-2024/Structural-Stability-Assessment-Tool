<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center Dashboard - Structural Stability Assessment</title>
    <!-- Socket.IO client library -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
        }
        .dashboard-header {
            background-color: #263238;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .dashboard-title {
            margin: 0;
            font-size: 1.8em;
        }
        .dashboard-subtitle {
            font-weight: normal;
            font-size: 1em;
            margin-top: 5px;
            opacity: 0.8;
        }
        .dashboard-actions {
            display: flex;
            gap: 15px;
        }
        .dashboard-content {
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        .status-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .status-number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .status-label {
            color: #555;
            font-size: 0.9em;
            text-align: center;
        }
        .risk-high {
            color: #e53935;
        }
        .risk-moderate {
            color: #ff9800;
        }
        .risk-safe {
            color: #43a047;
        }
        .victim-status {
            color: #2196f3;
        }
        .hazard-status {
            color: #9c27b0;
        }
        .priority-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .priority-critical {
            background-color: #e53935;
        }
        .priority-high {
            background-color: #ff9800;
        }
        .priority-moderate {
            background-color: #ffc107;
        }
        .priority-low {
            background-color: #4caf50;
        }
        .blueprints-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .blueprint-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        .blueprint-card:hover {
            transform: translateY(-5px);
        }
        .blueprint-image {
            height: 200px;
            overflow: hidden;
            position: relative;
        }
        .blueprint-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .blueprint-image .status-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-size: 0.8em;
            font-weight: bold;
        }
        .badge-assessed {
            background-color: #43a047;
        }
        .badge-unassessed {
            background-color: #757575;
        }
        .badge-in-progress {
            background-color: #1976d2;
        }
        .blueprint-info {
            padding: 15px;
        }
        .blueprint-name {
            margin: 0 0 10px;
            font-size: 1.2em;
        }
        .blueprint-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
            color: #555;
        }
        .blueprint-actions {
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            background-color: #f9f9f9;
        }
        .btn {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background-color: #1976d2;
        }
        .btn-danger {
            background-color: #e53935;
        }
        .btn-danger:hover {
            background-color: #c62828;
        }
        .live-updates {
            background-color: #fff3e0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .update-feed {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .update-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
        }
        .update-item:last-child {
            border-bottom: none;
        }
        .update-time {
            color: #777;
            font-size: 0.8em;
        }
        .dashboard-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-dropdown {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
        }
        .active-users {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            max-width: 250px;
        }
        .user-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <header class="dashboard-header">
        <div>
            <h1 class="dashboard-title">Command Center Dashboard</h1>
            <p class="dashboard-subtitle">Structural Stability Assessment - Real-time Monitoring</p>
        </div>
        <div class="dashboard-actions">
            <button id="refreshBtn" class="btn">üîÑ Refresh Data</button>
            <a href="/" class="btn">üîç Open Annotator</a>
        </div>
    </header>
    
    <div class="dashboard-content">
        <div class="status-overview">
            <div class="status-card">
                <div class="status-label">Total Assessed Blueprints</div>
                <div id="total-assessed" class="status-number">0</div>
            </div>
            <div class="status-card">
                <div class="status-label">High Risk Areas</div>
                <div id="high-risk" class="status-number risk-high">0</div>
            </div>
            <div class="status-card">
                <div class="status-label">Moderate Risk Areas</div>
                <div id="moderate-risk" class="status-number risk-moderate">0</div>
            </div>
            <div class="status-card">
                <div class="status-label">Victims Located</div>
                <div id="victims-count" class="status-number victim-status">0</div>
            </div>
            <div class="status-card">
                <div class="status-label">Secondary Hazards</div>
                <div id="hazards-count" class="status-number hazard-status">0</div>
            </div>
            <div class="status-card">
                <div class="status-label">Active Rescuers</div>
                <div id="active-rescuers" class="status-number">0</div>
            </div>
        </div>
        
        <!-- Victim Localization Dashboard -->
        <div style="margin: 30px 0;">
            <h2>üë§ Victim Localization Status</h2>
            <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                <!-- Victim Status Panel -->
                <div style="flex: 1; min-width: 300px; background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                    <h3>Victim Status Overview</h3>
                    <table style="width: 100%; margin-top: 15px; border-collapse: collapse;">
                        <thead style="background-color: #f5f5f5;">
                            <tr>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Priority</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Status</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Count</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Photo Available</th>
                            </tr>
                        </thead>
                        <tbody id="victim-status-table">
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-critical"></span> Critical</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Confirmed</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="confirmed-count">0</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="confirmed-photos">0</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-high"></span> High</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Suspected</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="suspected-count">0</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="suspected-photos">0</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-high"></span> High</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Responsive</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="responsive-count">0</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="responsive-photos">0</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-low"></span> Low</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Rescued</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="rescued-count">0</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="rescued-photos">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Secondary Hazards Panel -->
                <div style="flex: 1; min-width: 300px; background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                    <h3>Secondary Hazards Overview</h3>
                    <table style="width: 100%; margin-top: 15px; border-collapse: collapse;">
                        <thead style="background-color: #f5f5f5;">
                            <tr>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Hazard Type</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Count</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Risk Level</th>
                            </tr>
                        </thead>
                        <tbody id="hazard-status-table">
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">üî• Fire</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="fire-count">0</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-critical"></span> Critical</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">‚òÅÔ∏è Gas Leak</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="gas-count">0</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-high"></span> High</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">üíß Flooding</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="flood-count">0</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-moderate"></span> Moderate</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">üåä Unstable Floor</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="floor-count">0</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-high"></span> High</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">üö´ Blocked Exit</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="exit-count">0</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-high"></span> High</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">‚ö° Electrical</td>
                                <td style="padding: 10px; text-align: center; border-bottom: 1px solid #eee;" id="electrical-count">0</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="priority-indicator priority-high"></span> High</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="dashboard-filters">
            <select class="filter-dropdown" id="status-filter">
                <option value="all">All Statuses</option>
                <option value="assessed">Assessed</option>
                <option value="unassessed">Unassessed</option>
                <option value="in-progress">In Progress</option>
            </select>
            <select class="filter-dropdown" id="risk-filter">
                <option value="all">All Risk Levels</option>
                <option value="high">High Risk</option>
                <option value="moderate">Moderate Risk</option>
                <option value="low">Low Risk</option>
            </select>
            <input type="text" id="search-input" placeholder="Search blueprints..." class="filter-dropdown" style="flex-grow: 1; max-width: 300px;">
        </div>

        <h2>Blueprint Assessments</h2>
        <div id="blueprints-grid" class="blueprints-grid">
            <!-- Blueprint cards will be generated here -->
        </div>

        <div class="live-updates">
            <h2>üì° Live Updates</h2>
            <div id="update-feed" class="update-feed">
                <!-- Live updates will appear here -->
            </div>
        </div>
    </div>

    <div class="active-users">
        <h3>üö® Active Rescuers</h3>
        <div id="active-users-list">
            <!-- Active users will be listed here -->
        </div>
    </div>

    <script>
        // Initialize Socket.IO connection
        const socket = io();
        const updateFeed = document.getElementById('update-feed');
        const blueprintsGrid = document.getElementById('blueprints-grid');
        const activeUsersList = document.getElementById('active-users-list');
        
        // Dashboard counts
        let totalAssessed = 0;
        let highRiskAreas = 0;
        let moderateRiskAreas = 0;
        let activeRescuers = 0;
        
        // Track all blueprints data
        let blueprintsData = [];
        
        // Initial data load
        window.addEventListener('load', () => {
            loadDashboardData();
            
            // Connect to socket for real-time updates
            socket.on('connect', () => {
                console.log('Connected to Command Center');
                addUpdate('Command Center dashboard connected');
            });
            
            // Listen for assessment updates
            socket.on('assessment_update', (data) => {
                addUpdate(`Blueprint ${data.filename} assessment updated`);
                updateBlueprintCard(data);
                updateCounters();
            });
            
            // Listen for victim updates
            socket.on('victim_update', (data) => {
                addUpdate(`Victim marked in ${data.filename}: ${data.type} at (${Math.round(data.x)}, ${Math.round(data.y)})`);
                loadDashboardData(); // Refresh all data
            });
            
            // Listen for secondary hazard updates
            socket.on('hazard_update', (data) => {
                addUpdate(`Secondary hazard in ${data.filename}: ${data.type.replace('_', ' ')} at (${Math.round(data.x)}, ${Math.round(data.y)})`);
                loadDashboardData(); // Refresh all data
            });
            
            // Listen for user updates
            socket.on('user_update', (data) => {
                updateActiveUsers(data.users);
                activeRescuers = data.users.length;
                document.getElementById('active-rescuers').innerText = activeRescuers;
            });
            
            // Set up filter listeners
            document.getElementById('status-filter').addEventListener('change', filterBlueprints);
            document.getElementById('risk-filter').addEventListener('change', filterBlueprints);
            document.getElementById('search-input').addEventListener('input', filterBlueprints);
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', loadDashboardData);
        });
        
        // Load dashboard data
        function loadDashboardData() {
            fetch('/get_assessments')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        blueprintsData = data.assessments;
                        renderBlueprints(blueprintsData);
                        updateCounters();
                        addUpdate('Dashboard data refreshed');
                    } else {
                        addUpdate('Error loading data: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error fetching dashboard data:', error);
                    addUpdate('Error connecting to server');
                });
        }
        
        // Render blueprint cards
        function renderBlueprints(blueprints) {
            blueprintsGrid.innerHTML = '';
            
            if (blueprints.length === 0) {
                blueprintsGrid.innerHTML = '<p>No blueprints found.</p>';
                return;
            }
            
            blueprints.forEach(blueprint => {
                const card = createBlueprintCard(blueprint);
                blueprintsGrid.appendChild(card);
            });
        }
        
        // Create blueprint card
        function createBlueprintCard(blueprint) {
            const card = document.createElement('div');
            card.className = 'blueprint-card';
            card.dataset.filename = blueprint.filename;
            
            const statusClass = blueprint.status === 'assessed' ? 'badge-assessed' : 'badge-unassessed';
            const statusText = blueprint.status === 'assessed' ? 'Assessed' : 'Not Assessed';
            
            const highRisk = blueprint.high_risk_zones || 0;
            const moderateRisk = blueprint.moderate_risk_zones || 0;
            
            card.innerHTML = `
                <div class="blueprint-image">
                    <img src="/static/converted/${blueprint.filename}" alt="${blueprint.filename}" onerror="this.src='https://via.placeholder.com/300x200?text=Blueprint+Image'">
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </div>
                <div class="blueprint-info">
                    <h3 class="blueprint-name">${blueprint.filename}</h3>
                    <div class="blueprint-stats">
                        <div class="stat">
                            <span class="risk-high">‚ö†Ô∏è</span>
                            <span>${highRisk} high risk</span>
                        </div>
                        <div class="stat">
                            <span class="risk-moderate">‚ö†Ô∏è</span>
                            <span>${moderateRisk} moderate</span>
                        </div>
                        <div class="stat">
                            <span class="victim-status">üë§</span>
                            <span>${blueprint.victims ? blueprint.victims.length : 0} victims</span>
                        </div>
                        <div class="stat">
                            <span class="hazard-status">‚ö°</span>
                            <span>${blueprint.hazards ? blueprint.hazards.length : 0} hazards</span>
                        </div>
                    </div>
                </div>
                <div class="blueprint-actions">
                    <a href="/?file=${encodeURIComponent(blueprint.filename)}" class="btn">View Details</a>
                    <button class="btn btn-danger" onclick="notifyRescuers('${blueprint.filename}')">Alert Rescuers</button>
                </div>
            `;
            
            return card;
        }
        
        // Update blueprint card
        function updateBlueprintCard(blueprint) {
            const existingCard = document.querySelector(`.blueprint-card[data-filename="${blueprint.filename}"]`);
            if (existingCard) {
                const newCard = createBlueprintCard(blueprint);
                existingCard.replaceWith(newCard);
            } else {
                const newCard = createBlueprintCard(blueprint);
                blueprintsGrid.appendChild(newCard);
            }
        }
        
        // Add update to feed
        function addUpdate(message) {
            const updateItem = document.createElement('div');
            updateItem.className = 'update-item';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            updateItem.innerHTML = `
                <div>${message}</div>
                <span class="update-time">${timeString}</span>
            `;
            
            updateFeed.prepend(updateItem);
            
            // Limit updates to 50
            if (updateFeed.children.length > 50) {
                updateFeed.removeChild(updateFeed.lastChild);
            }
        }
        
        // Update active users list
        function updateActiveUsers(users) {
            activeUsersList.innerHTML = '';
            
            if (!users || users.length === 0) {
                activeUsersList.innerHTML = '<p>No active rescuers</p>';
                return;
            }
            
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.style.margin = '8px 0';
                userItem.innerHTML = `
                    <span class="user-dot" style="background-color: ${user.color}"></span>
                    ${user.username} ${user.current_blueprint ? `(viewing ${user.current_blueprint})` : ''}
                `;
                activeUsersList.appendChild(userItem);
            });
        }
        
        // Filter blueprints
        function filterBlueprints() {
            const statusFilter = document.getElementById('status-filter').value;
            const riskFilter = document.getElementById('risk-filter').value;
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            const filtered = blueprintsData.filter(blueprint => {
                // Status filter
                if (statusFilter !== 'all' && blueprint.status !== statusFilter) {
                    return false;
                }
                
                // Risk filter
                if (riskFilter !== 'all') {
                    if (riskFilter === 'high' && blueprint.high_risk_zones <= 0) {
                        return false;
                    }
                    if (riskFilter === 'moderate' && blueprint.moderate_risk_zones <= 0) {
                        return false;
                    }
                    if (riskFilter === 'low' && 
                        (blueprint.high_risk_zones > 0 || blueprint.moderate_risk_zones > 0)) {
                        return false;
                    }
                }
                
                // Search filter
                if (searchTerm && !blueprint.filename.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                return true;
            });
            
            renderBlueprints(filtered);
        }
        
        // Update dashboard counters
        function updateCounters() {
            totalAssessed = blueprintsData.filter(b => b.status === 'assessed').length;
            highRiskAreas = blueprintsData.reduce((sum, b) => sum + (b.high_risk_zones || 0), 0);
            moderateRiskAreas = blueprintsData.reduce((sum, b) => sum + (b.moderate_risk_zones || 0), 0);
            
            // Count victims and hazards
            const victimCounts = {
                confirmed: 0,
                suspected: 0,
                responsive: 0,
                rescued: 0,
                confirmWithPhoto: 0,
                suspectedWithPhoto: 0,
                responsiveWithPhoto: 0,
                rescuedWithPhoto: 0
            };
            
            const hazardCounts = {
                fire: 0,
                gas_leak: 0,
                flooding: 0,
                unstable_floor: 0,
                blocked_exit: 0,
                electrical: 0
            };
            
            // Process victim and hazard data
            blueprintsData.forEach(blueprint => {
                // Victims
                if (blueprint.victims) {
                    blueprint.victims.forEach(victim => {
                        if (victim.type === 'confirmed') {
                            victimCounts.confirmed++;
                            if (victim.hasPhoto) victimCounts.confirmWithPhoto++;
                        } else if (victim.type === 'suspected') {
                            victimCounts.suspected++;
                            if (victim.hasPhoto) victimCounts.suspectedWithPhoto++;
                        } else if (victim.type === 'responsive') {
                            victimCounts.responsive++;
                            if (victim.hasPhoto) victimCounts.responsiveWithPhoto++;
                        } else if (victim.type === 'rescued') {
                            victimCounts.rescued++;
                            if (victim.hasPhoto) victimCounts.rescuedWithPhoto++;
                        }
                    });
                }
                
                // Hazards
                if (blueprint.hazards) {
                    blueprint.hazards.forEach(hazard => {
                        if (hazardCounts.hasOwnProperty(hazard.type)) {
                            hazardCounts[hazard.type]++;
                        }
                    });
                }
            });
            
            // Update main counters
            document.getElementById('total-assessed').innerText = totalAssessed;
            document.getElementById('high-risk').innerText = highRiskAreas;
            document.getElementById('moderate-risk').innerText = moderateRiskAreas;
            
            // Update victim counter
            const totalVictims = victimCounts.confirmed + victimCounts.suspected + 
                                victimCounts.responsive + victimCounts.rescued;
            document.getElementById('victims-count').innerText = totalVictims;
            
            // Update hazard counter
            const totalHazards = Object.values(hazardCounts).reduce((sum, count) => sum + count, 0);
            document.getElementById('hazards-count').innerText = totalHazards;
            
            // Update victim details
            document.getElementById('confirmed-count').innerText = victimCounts.confirmed;
            document.getElementById('suspected-count').innerText = victimCounts.suspected;
            document.getElementById('responsive-count').innerText = victimCounts.responsive;
            document.getElementById('rescued-count').innerText = victimCounts.rescued;
            
            document.getElementById('confirmed-photos').innerText = victimCounts.confirmWithPhoto;
            document.getElementById('suspected-photos').innerText = victimCounts.suspectedWithPhoto;
            document.getElementById('responsive-photos').innerText = victimCounts.responsiveWithPhoto;
            document.getElementById('rescued-photos').innerText = victimCounts.rescuedWithPhoto;
            
            // Update hazard details
            document.getElementById('fire-count').innerText = hazardCounts.fire;
            document.getElementById('gas-count').innerText = hazardCounts.gas_leak;
            document.getElementById('flood-count').innerText = hazardCounts.flooding;
            document.getElementById('floor-count').innerText = hazardCounts.unstable_floor;
            document.getElementById('exit-count').innerText = hazardCounts.blocked_exit;
            document.getElementById('electrical-count').innerText = hazardCounts.electrical;
        }
        
        // Notify rescuers (send alert to specific blueprint room)
        function notifyRescuers(filename) {
            socket.emit('command_center_alert', {
                blueprint: filename,
                message: 'URGENT: Command Center is requesting immediate attention on this blueprint.'
            });
            
            addUpdate(`Alert sent to rescuers working on ${filename}`);
        }
    </script>
</body>
</html>